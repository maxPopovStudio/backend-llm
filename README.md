# Технічне завдання: Node.js API для генерації ECharts конфігурацій через локальну web опитимізовану LLM

## 1. Опис завдання

Потрібно розробити Node.js REST API сервер, який:

- Приймає вільний текст на вхід
- Обробляє його через локальну LLM модель яка працює через transfomersjs (onnx-community)
- Генерує JSON конфігурацію для Apache ECharts
- Повертає готову конфігурацію, яку можна одразу використати для візуалізації

## 2. Технічні вимоги

### 2.1. Інфраструктура та розгортання

- **Docker** - обов'язкове використання для запуску всього проекту
- **Docker Compose** - для оркестрації сервісів
- **PostgreSQL** - база даних для зберігання всіх даних (обов'язково в Docker контейнері)

#### Docker Compose структура

Проект повинен містити `docker-compose.yml` з наступними сервісами:

- **app** - Node.js API сервер
- **postgres** - PostgreSQL база даних

### 2.2. Технологічний стек

- **Node.js** (версія 22+)
- **TypeScript** (обов'язково)
- **Express.js** або **Fastify** для REST API
- **@huggingface/transformers** для роботи з LLM моделлю
- **PostgreSQL** - для зберігання запитів, результатів та кроків обробки

### 2.3. LLM Модель

- **Модель**: `Qwen/Gemma/інша`
- **Обмеження моделей**: моделі "стисненні" для роботи в браузері або локально, тому мають обмеження по розміру контекстного вікна та розумовим здібностям. Тому задача не вирішується напряму як в комерційних моделях - вставити текст+шаблон => отримати готовий JSON.

## 3. API Специфікація

### 3.1. Endpoint

#### POST /api/analyze

**Request Body:**
```json
{
  "text": "Продажі за місяцями:\nСічень: 120\nЛютий: 150\nБерезень: 180"
}
```

**Response (Success):**
```json
{
  "success": true,
  "echartsConfig": {
    "title": {
      "text": "Продажі за місяцями"
    },
    "tooltip": {},
    "xAxis": {
      "type": "category",
      "data": ["Січень", "Лютий", "Березень"]
    },
    "yAxis": {
      "type": "value"
    },
    "series": [
      {
        "type": "bar",
        "data": [120, 150, 180]
      }
    ]
  }
}
```

**Response (Error):**
```json
{
  "success": false,
  "error": "Помилка обробки тексту",
  "details": "..."
}
```

### 3.2. Типи діаграм

Підтримуються наступні типи (описані в `echarts-chart-types.json`):

- `line` - Лінійна діаграма
- `bar` - Стовпчаста діаграма
- `bar-grouped` - Згрупована стовпчаста діаграма
- `pie` - Кругова діаграма
- `funnel` - Воронкоподібна діаграма

## 4. База даних та зберігання даних

### 4.1. Вимоги до PostgreSQL

- База даних повинна запускатися в Docker контейнері
- Необхідно враховувати, що в БД буде зберігатися **>1 мільйон записів**
- В майбутньому буде доданий пошук з фільтрами (як мінімум по датах запитів)
- Потрібно спроектувати індекси для оптимізації запитів

### 4.2. Вимоги до зберігання даних

- **Обов'язкове зберігання**: кожен вхідний запит до API повинен зберігатися в БД
- **Логування кроків**: всі проміжні кроки обробки запиту повинні зберігатися окремо
- **Збереження результатів**: успішні та неуспішні результати обробки повинні зберігатися
- **Класифікація**: кожен запит повинен мати тип з довідника для подальшої статистики

## 5. Вимоги до реалізації

### 5.1. Ініціалізація моделі

- Модель завантажується при старті сервера
- Pipeline зберігається в пам'яті для повторного використання

### 5.2. Обмеження

- Максимальна довжина тексту: **1024 символи**
- Таймаут на обробку: **120 секунд**

### 5.3. Формат відповіді ECharts

Відповідь повинна містити повну конфігурацію ECharts, яку можна одразу використати тут:

<https://stackblitz.com/edit/echart-playground?file=index.html&utm_source=chatgpt.com>

### 5.4. Приклади curl запитів для тестування

Обов'язково надати приклади curl запитів для тестування API.

## 6. Посилання на ресурси

- [Apache ECharts Documentation](https://echarts.apache.org/en/option.html)
- [@huggingface/transformers](https://huggingface.co/docs/transformers.js)
- [Qwen Model on Hugging Face](https://huggingface.co/Xenova/Qwen1.5-0.5B-Chat)
- [StackBlitz ECharts Playground](https://stackblitz.com/edit/echart-playground)
